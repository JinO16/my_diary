# 获取

## 内容输入

如果输入的是搜索内容，则浏览器会打开默认的搜索引擎，进行内容的搜索；如果输入的是url，会进行协议等内容的匹配，符合url规则后进行url的请求。

> url内容包括：协议、主机名称、端口号、路径地址、参数和锚点

## 缓存
在请求之前首先浏览器会先查看是否存在本地缓存或者本地缓存是否失效，如果没有失效，则直接进行渲染【**策略：强缓存**】；如果本地缓存失效，则浏览器就会使用网络进程发起网络请求。

在向服务器发起请求时，浏览器询问服务器，是否资源真的已经更新了，如果资源已经更新，那么服务器会返回最新的资源和缓存标识；如果资源未更新，则服务器会告知浏览器，可以直接使用缓存中的内容【**策略：协商缓存**】。

### 强缓存与协商缓存策略

强缓存是指浏览器在发起请求之前查看本地缓存的资源,根据本地缓存的失效与否决定是否使用本地缓存的策略，强缓存有两种形式：expires和catch-control，expires标识的是资源失效的时间，catch-control标识的是资源从失效的最长时间段；

协商缓存是指当浏览器的强缓存失效后，浏览器会发起请求询问服务器资源是否已经更新，如果未更新，服务器会返回状态码为304，告知浏览器资源未更新，可以直接使用缓存中的资源；如果资源已经更新，服务器会返回最新资源及最新的缓存标识给浏览器，浏览器的网络进程获取到资源，将资源返回给浏览器进程；

### 浏览器与服务器是如何交互的？
当浏览器未命中强缓存时，向服务器发起资源请求，在请求头上，浏览器会将上一次服务器返回最新资源时返回的Etag标识及最后的修改时间LastModified作为请求头信息：if-none-match和if-modified-since的值，发送给服务器，服务器接收到后，会对比if-modified-since的值与资源最后的修改时间LastModified，对比if-none-match的值与服务器对资源生成的Etag值是否一致，如果都没有变化，则返回304状态码，告知浏览器资源未更新，可以直接使用缓存；如果有变化，则返回状态码200，并返回新的资源和新的缓存标识；浏览器接收到将缓存标识更新，并将新的资源交给浏览器进程进入下一阶段。

## 网络请求



发起网络请求到数据的传输主要有三大方面，一个是DNS域名解析，将访问域名地址解析为对应的服务器IP地址；一个是建立TCP的连接，包括TCP的三次握手，如果是HTTPS协议，则需要进行TLS的连接；最后一个就是连接成功后进行数据的传输。

### DNS域名解析

在发起请求之前，由于浏览器是无法根据url地址的域名地址访问到对应的服务器的，每一个服务器都会对应一个IP地址，所以需要将域名解析为IP地址，这个过程就是DNS域名解析过程。

DNS域名解析其实是查询的过程，浏览器向本地DNS服务器发起访问请求,本地DNS服务器查找并返回对应服务器的IP地址的过程。查询过程分为递归查询和迭代查询两大部分：

> 本地DNS服务器指的是每一个ISP（运营商）都有一个本地的DNS服务器，比如一个社区的ISP、一个大学的ISP、一个机构的ISP，都会有一台或者多台DNS服务器，当本地的客户端发起DNS请求时，该请求都会发往本地DNS服务器。
>

当本地DNS服务器接收到浏览器的请求后，就会首先在本地缓存中查看是否存在该域名的IP地址，如果存在则返回；如果不存在，则查询操作系统中是否存在，如果存在，则返回，不存在，则查询是否路由器等设备上是否存在该IP地址，一层层查找，直到找到后返回给浏览器，这个过程为递归查询。

当缓存内都不存在，本地的DNS服务器就会代替浏览器向其他域名服务器访问，当向根域名服务器访问时，根域名服务器会返回对应顶级域名的ip地址，告诉DNS服务器去顶级域名询问是否存在；顶级域名就会告诉下一阶段域名的IP地址，告诉DNS服务器询问是否存在需要访问的域名地址，一直到DNS服务器找到；

在DNS服务器询问根域名、顶级域名并拿到对应信息再进行下一个步骤，直到找到对应服务器的IP地址的过程为迭代查询。DNS服务器拿到域名IP地址返回给浏览器的过程为递归查询。

本地DNS服务器拿到IP后会将其返回给浏览器并将IP地址放在缓存中。

<img src="./images/dns-analysis.png">

>
> DNS缓存包括浏览器缓存、本地DNS服务器缓存、操作系统缓存、路由器缓存、根域名服务器缓存、顶级域名服务器缓存、主域名服务器缓存
>
### DNS负载均衡

负载均衡是指在我们在网站中可能会发起大量的请求，如果所有的请求都打到一个服务器上，则这台服务器的压力会很大,响应速度慢，甚至可能会崩溃，因此当一个网站有多个服务器地址时，在应答DNS查询的时候，DNS会对每一个查询返回不同的结果，这样就会将资源分散到不同的服务器上，达到负载均衡的效果。比如可以根据每台机器的负载量以及该机器对于用户的物理距离等条件；比如CDN其实就是通过DNS的负载均衡，将距离该url最近的节点的IP地址返回给浏览器，浏览器在请求资源时，就会自然请求到最近的这个节点中的资源。

### DNS**预解析**
DNS预解析主要是在浏览网页时，对网页中需要进行DNS解析的域名优先进行DNS的解析和缓存，从而达到减少响应时间,提高用户体验的作用。
比如有很多大型网站，需要很多不同服务器的域名的资源，就可以配置DNS预解析 rel="dns-prefetch",提前解析,减少页面卡顿。
<img src="./images/dns-pre-fetch.png" />

<!--**在整个过程中什么时候解析呢?**-->

### TCP三次握手

客户端和服务端在进行数据传输的过程中，由于HTTP不存在连接的概念，他只有请求和响应，因此需要建立一个用来承载http的数据包传送的通道，这个通道就是TCP connection。



TLS连接

# 解析和构建



# 渲染